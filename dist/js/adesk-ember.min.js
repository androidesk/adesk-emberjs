/*! adesk-ember - v1.0.02015-04-07
https://github.com/androidesk
* Copyright (c) 2015 zhyq0826: adesk @安卓壁纸 https://github.com/androidesk */
Ember.TEMPLATES["adesk/js/templates/components/ui-message-view"]=Ember.Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,Ember.Handlebars.helpers),e=e||{};var f,g="";return e.buffer.push("<p>"),f=c._triageMustache.call(b,"msg",{hash:{},hashTypes:{},hashContexts:{},contexts:[b],types:["ID"],data:e}),(f||0===f)&&e.buffer.push(f),e.buffer.push("</p>\n"),g}),Ember.TEMPLATES["adesk/js/templates/components/ui-pagination-view"]=Ember.Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,Ember.Handlebars.helpers),e=e||{};var f="",g=this.escapeExpression;return e.buffer.push('\n<div class="ui left labeled icon button" '),e.buffer.push(g(c.action.call(b,"prevPage",{hash:{},hashTypes:{},hashContexts:{},contexts:[b],types:["STRING"],data:e}))),e.buffer.push(' >\n  <i class="left arrow icon"></i>\n  prev page\n</div>\n\n<div class="ui right labeled icon button" '),e.buffer.push(g(c.action.call(b,"nextPage",{hash:{},hashTypes:{},hashContexts:{},contexts:[b],types:["STRING"],data:e}))),e.buffer.push(' >\n  <i class="right arrow icon"></i>\n  next page\n</div>'),f}),Ember.ButtonView=Ember.View.extend({tagName:"button",classNames:["ui","button","small"],classNameBindings:["isLoading:loading"],isLoading:!1,isLoadingBinding:"controller.isSaving",attributeBindings:["style"],style:""}),Ember.MessageView=Ember.View.extend({tagName:"div",classNames:["ui","message"],classNameBindings:["isSuccess:positive","isError:negative","isTip::hidden"],isSuccess:!1,isSuccessBinding:"controller.isSuccess",isError:!1,isErrorBinding:"controller.isError",isTip:!1,isTipBinding:"controller.isTip",attributeBindings:["style"],style:"",layoutName:"components/ui-message-view"}),Ember.PaginationView=Ember.View.extend({tagName:"div",classNames:[],attributeBindings:["style"],style:"position:fixed; bottom:0px;left:50%;margin-left:-150px;z-index:7",layoutName:"components/ui-pagination-view"});var FormMixin=Ember.Mixin.create({isSaving:!1,isSuccess:!1,isError:!1,actions:{saveForm:function(a,b){var c=this;this.store.find(a).save(b).then(function(a){var b="你的网络有问题或网站的服务出了问题";0===a.code?(c.toggleProperty("isSuccess"),c.set("msg","修改成功"),c.toggleProperty("isEditMode")):(c.toggleProperty("isError"),c.set("msg",a.msg||b))},function(a){c.toggleProperty("isError"),c.set("msg",error)})},createForm:function(){this.toggleProperty("isCreateMode")},edit:function(){this.toggleProperty("isEditMode")}},isSuccessObserver:Ember.immediateObserver("isSuccess",function(){this.get("isSuccess")&&(this.set("isError",!1),this.set("isSaving",!1))}),isErrorObserver:Ember.immediateObserver("isError",function(){this.get("isError")&&(this.set("isSuccess",!1),this.set("isSaving",!1))}),isSavingObserver:Ember.immediateObserver("isSaving",function(){this.get("isSaving")&&(this.set("isSuccess",!1),this.set("isError",!1))}),isTip:function(){return this.get("isSuccess")||this.get("isError")}.property("isSuccess","isError"),isEditMode:!1,isEditModeObserver:Ember.immediateObserver("isEditMode",function(){this.set("isSaving",!1),this.set("isError",!1),this.set("isSuccess",!1),this.set("isCreateMode",!1);var a="#"+this.get("_id");Ember.$(a).modal(this.get("isEditMode")?"show":"hide")}),isCreateMode:!1,isCreateModeObserver:Ember.immediateObserver("isCreateMode",function(){this.set("isSaving",!1),this.set("isError",!1),this.set("isSuccess",!1),this.set("isEditMode",!1);var a="#newForm";Ember.$(a).modal(this.get("isCreateMode")?"show":"hide")}),msg:""});Ember.FormObject=Ember.ObjectController.extend(FormMixin);var paginationControllerMixin=Ember.Mixin.create({queryParams:["skip"],skip:0,limit:20,actions:{prevPage:function(){var a=this.skip-this.limit;0>a&&(a=0),this.set("skip",a),this.transitionToRoute({queryParams:{skip:a}})},nextPage:function(){var a=this.skip+this.limit;this.get("model").length%this.limit===0&&this.transitionToRoute({queryParams:{skip:a}})}}}),paginationMixinRoute=Ember.Mixin.create({queryParams:{skip:{refreshModel:!0}}});Ember.ArrayController=Ember.ArrayController.extend(paginationControllerMixin),Ember.Route=Ember.Route.extend(paginationMixinRoute),Ember.Model=Ember.Object.extend(Ember.Evented,{rootURL:"",rootKey:"",url:"",primaryKey:"_id",api:function(){return this.rootURL+this.url}.property("url"),save:function(){var a=this,b=this.get("primaryKey"),c={};return Ember.$.each(Ember.keys(model),function(b,d){a.model.hasOwnProperty(d)&&(c[d]=model[d])}),model[b]&&(c[b]=model[b]),Ember.$.post(this.get("api"),c,function(){},"json").then(function(a){return a})},createRecord:function(){return Ember.Object.create(this.model)},deleteRecord:function(a){var b=this,c=b.get("primaryKey");return Ember.$.ajax({type:"delete",url:b.get("api"),data:{_id:a[c]},dataType:"json"}).then(function(a){return a})},find:function(a){var b=this;return a=b._filterParams(a),Ember.$.getJSON(this.get("api"),a||{}).then(function(a){return a.res[b.get("rootKey")]})},findOne:function(a){return Ember.$.getJSON(this.get("api")+"/"+a).then(function(a){return a.res[$this.get("rootKey")]})},_filterParams:function(){if(params){for(var a in params)params.hasOwnProperty(a)&&!params[a]&&delete params[a];return params}}}),Ember.Store=Ember.Object.extend({modelFor:function(a){return this.container.lookupFactory("model:"+a)},find:function(a,b){return this.modelFor(a).find(b)},findOne:function(a,b){return this.modelFor(a).findOne(b)}}),Ember.onLoad("Ember.Application",function(a){a.initializer({name:"store",initialize:function(a,b){b.register("store:main",a.lookupFactory("store:application")||Ember.Store),b.inject("route","store","store:main"),b.inject("controller","store","store:main")}})});