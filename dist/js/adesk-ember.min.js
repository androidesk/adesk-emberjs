/*! adesk-ember - v1.0.02015-04-09
https://github.com/androidesk
* Copyright (c) 2015 zhyq0826: adesk @安卓壁纸 https://github.com/androidesk */
Ember.TEMPLATES["components/ui-message-view"]=Ember.Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,Ember.Handlebars.helpers),e=e||{};var f,g="";return e.buffer.push("<p>"),f=c._triageMustache.call(b,"msg",{hash:{},hashTypes:{},hashContexts:{},contexts:[b],types:["ID"],data:e}),(f||0===f)&&e.buffer.push(f),e.buffer.push("</p>\n"),g}),Ember.TEMPLATES["components/ui-pagination-view"]=Ember.Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,Ember.Handlebars.helpers),e=e||{};var f="",g=this.escapeExpression;return e.buffer.push('\n<div class="ui left labeled icon button" '),e.buffer.push(g(c.action.call(b,"prevPage",{hash:{},hashTypes:{},hashContexts:{},contexts:[b],types:["STRING"],data:e}))),e.buffer.push(' >\n  <i class="left arrow icon"></i>\n  prev page\n</div>\n\n<div class="ui right labeled icon button" '),e.buffer.push(g(c.action.call(b,"nextPage",{hash:{},hashTypes:{},hashContexts:{},contexts:[b],types:["STRING"],data:e}))),e.buffer.push(' >\n  <i class="right arrow icon"></i>\n  next page\n</div>'),f});var buttonView=Ember.View.extend({didInsertElement:function(){this.$().html("save")},tagName:"button",classNames:["ui","button","small"],classNameBindings:["isLoading:loading"],isLoading:!1,isLoadingBinding:"controller.isSaving",attributeBindings:["style"],style:""});Ember.Handlebars.helper("ui-button",buttonView);var messageView=Ember.View.extend({tagName:"div",classNames:["ui","message"],classNameBindings:["isSuccess:positive","isError:negative","isTip::hidden"],isSuccess:!1,isSuccessBinding:"controller.isSuccess",isError:!1,isErrorBinding:"controller.isError",isTip:!1,isTipBinding:"controller.isTip",attributeBindings:["style"],style:"",layoutName:"components/ui-message-view"});Ember.Handlebars.helper("ui-message",messageView);var paginationView=Ember.View.extend({tagName:"div",classNames:[],attributeBindings:["style"],style:"position:fixed; bottom:0px;left:50%;margin-left:-150px;z-index:7",layoutName:"components/ui-pagination-view"});Ember.Handlebars.helper("ui-pagination",paginationView);var FormMixin=Ember.Mixin.create({isSaving:!1,isSuccess:!1,isError:!1,actions:{saveForm:function(a){var b=this;console.log(b.modelName),this.store.save(b.modelName,a).then(function(a){var c="你的网络有问题或网站的服务出了问题";0===a.code?(b.toggleProperty("isSuccess"),b.set("msg","修改成功"),b.toggleProperty("isEditMode")):(b.toggleProperty("isError"),b.set("msg",a.msg||c))},function(a){b.toggleProperty("isError"),b.set("msg",error)})},createForm:function(){this.toggleProperty("isCreateMode")},edit:function(){this.toggleProperty("isEditMode")}},isSuccessObserver:Ember.immediateObserver("isSuccess",function(){this.get("isSuccess")&&(this.set("isError",!1),this.set("isSaving",!1))}),isErrorObserver:Ember.immediateObserver("isError",function(){this.get("isError")&&(this.set("isSuccess",!1),this.set("isSaving",!1))}),isSavingObserver:Ember.immediateObserver("isSaving",function(){this.get("isSaving")&&(this.set("isSuccess",!1),this.set("isError",!1))}),isTip:function(){return this.get("isSuccess")||this.get("isError")}.property("isSuccess","isError"),isEditMode:!1,isEditModeObserver:Ember.immediateObserver("isEditMode",function(){this.set("isSaving",!1),this.set("isError",!1),this.set("isSuccess",!1),this.set("isCreateMode",!1);var a="#"+this.get("_id");Ember.$(a).modal(this.get("isEditMode")?"show":"hide")}),isCreateMode:!1,isCreateModeObserver:Ember.immediateObserver("isCreateMode",function(){this.set("isSaving",!1),this.set("isError",!1),this.set("isSuccess",!1),this.set("isEditMode",!1);var a="#newForm";Ember.$(a).modal(this.get("isCreateMode")?"show":"hide")}),msg:""});Ember.FormController=Ember.ObjectController.extend(FormMixin);var paginationControllerMixin=Ember.Mixin.create({queryParams:["skip"],skip:0,limit:20,actions:{prevPage:function(){var a=this.skip-this.limit;0>a&&(a=0),this.set("skip",a),this.transitionToRoute({queryParams:{skip:a}})},nextPage:function(){var a=this.skip+this.limit;this.get("model").length%this.limit===0&&this.transitionToRoute({queryParams:{skip:a}})}}}),paginationMixinRoute=Ember.Mixin.create({queryParams:{skip:{refreshModel:!0}}});Ember.ArrayController=Ember.ArrayController.extend(paginationControllerMixin),Ember.Route=Ember.Route.extend(paginationMixinRoute),Ember.Model=Ember.Object.extend(Ember.Evented,{rootURL:"",rootKey:"",url:"",primaryKey:"_id",api:function(){return this.rootURL+this.url}.property("url"),save:function(a){var b=this,c=this.get("primaryKey"),d={};return Ember.$.each(Ember.keys(a),function(c,e){b.model.hasOwnProperty(e)&&(d[e]=a[e])}),a[c]&&(d[c]=a[c]),Ember.$.ajax({type:"post",url:this.get("api"),data:d,dataType:"json",traditional:!0}).then(function(a){return a})},createRecord:function(){return Ember.Object.create(this.model)},deleteRecord:function(a){var b=this,c=b.get("primaryKey");return Ember.$.ajax({type:"delete",url:b.get("api")+"/"+a.get(c),dataType:"json"}).then(function(a){return a})},find:function(a){var b=this;return a=b._filterParams(a),Ember.$.getJSON(this.get("api"),a||{}).then(function(a){var c=[];return Ember.$.each(a.res[b.get("rootKey")],function(a,b){c.push(Ember.Object.create(b))}),c})},findOne:function(a){return Ember.$.getJSON(this.get("api")+"/"+a).then(function(a){return Ember.Object.create(a.res[$this.get("rootKey")])})},_filterParams:function(a){if(a){for(var b in a)a.hasOwnProperty(b)&&!a[b]&&delete a[b];return a}}}),Ember.Model.Store=Ember.Object.extend({modelFor:function(a){var b=this.container.lookupFactory("model:"+a);return b.create()},find:function(a,b){return this.modelFor(a).find(b)},findOne:function(a,b){return this.modelFor(a).findOne(b)},createRecord:function(a){return this.modelFor(a).createRecord()},deleteRecord:function(a,b){return this.modelFor(a).deleteRecord(b)},save:function(a,b){return this.modelFor(a).save(b)}}),Ember.onLoad("Ember.Application",function(a){a.initializer({name:"store",initialize:function(a,b){b.register("store:main",a.lookupFactory("store:application")||Ember.Model.Store),b.inject("route","store","store:main"),b.inject("controller","store","store:main")}})});